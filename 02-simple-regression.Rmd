# Simple Regression {#simple-regression}

```{r, echo = FALSE}
j <- c(
  "$v_1$",
  "$v_2$"
)
k <- "$u$"
all <- c(
  j,
  k
)
m1 <- -3.951208
m2 <- 13.038328
m3 <- 0
a12 <- 1.269259
a13 <- 1
omega22 <- 7.151261
omega33 <- 47.659854
A <- Omega <- matrix(
  data = 0,
  nrow = 3,
  ncol = 3
)
A[1, 2] <- a12
A[1, 3] <- a13
Omega[2, 2] <- omega22
Omega[3, 3] <- omega33
m <- matrix(
  data = c(
    m1,
    m2,
    m3
  ),
  ncol = 1
)
colnames(m) <- "$\\mathbf{m}$"
rownames(m) <- c(
  all
)
filter <- diag(3)
colnames(filter) <- c(
  all
)
rownames(filter) <- c(
  all
)
muv1 <- m1 + a12 * m2
muv2 <- m2
muv3 <- m3
mu <- matrix(
  data = c(
    muv1,
    muv2,
    muv3
  ),
  ncol = 1
)
rownames(mu) <- c(
  all
)
colnames(m) <- "$\\boldsymbol{\\mu}$"
cov11 <- a12^2 * omega22 + omega33
cov12 <- a12 * omega22
cov13 <- omega33
cov21 <- cov12
cov22 <- omega22
cov23 <- 0
cov31 <- omega33
cov32 <- cov23
cov33 <- omega33
Cov <- matrix(
  data = c(
    cov11,
    cov21,
    cov31,
    cov12,
    cov22,
    cov32,
    cov13,
    cov23,
    cov33
  ),
  ncol = 3
)
colnames(Cov) <- c(
  all
)
rownames(Cov) <- c(
  all
)
```

Let $v_1$, $v_2$, and $u$ be random variables whose associations are given by the regression equation

\begin{equation}
  \begin{split}
    v_1
    &=
    m_1 + a_{1, 2} v_2 + u \\
    &=
    `r m1` + `r a12` \cdot v_2 + u .
  \end{split}
\end{equation}

\noindent $v_1$ and $v_2$ are observed variables and
$u$ is a stochastic error term which is normally distributed around zero
with constant variance across values of $v_2$

\begin{equation}
  u 
  \sim 
  \mathcal{N} \left( m_3 = 0, \omega_{3, 3} = `r omega33` \right) .
\end{equation}

\noindent $v_2$ has a mean of $m_2 = `r m2`$ and a variance of $\omega_{2, 2} = `r omega22`$.

Below are two ways of specifying this model.
The first specification includes the error term $u$ as a latent variable.
The second specification only includes the observed variables.

## Specification 1 - Includes Error Term as a Latent Variable

### Matrix Notation

\begin{equation}
  \mathrm{variables}
  =
  \begin{bmatrix}
    v_1 \\
    v_2 \\
    u
  \end{bmatrix}
\end{equation}

\begin{equation}
  \mathbf{A}
  =
  \begin{bmatrix}
    0 & a_{1, 2} & 1 \\
    0 & 0        & 0 \\
    0 & 0        & 0
  \end{bmatrix}
  =
  \begin{bmatrix}
    `r A[1, 1]` & `r A[1, 2]` & `r A[1, 3]` \\
    `r A[2, 1]` & `r A[2, 2]` & `r A[2, 3]` \\
    `r A[3, 1]` & `r A[3, 2]` & `r A[3, 3]`
  \end{bmatrix}
\end{equation}

\begin{equation}
  \boldsymbol{\Omega}
  =
  \begin{bmatrix}
    0 & 0             & 0 \\
    0 & \omega_{2, 2} & 0 \\
    0 & 0             & \omega_{3, 3}
  \end{bmatrix}
  =
  \begin{bmatrix}
    `r Omega[1, 1]` & `r Omega[1, 2]` & `r Omega[1, 3]` \\
    `r Omega[2, 1]` & `r Omega[2, 2]` & `r Omega[2, 3]` \\
    `r Omega[3, 1]` & `r Omega[3, 2]` & `r Omega[3, 3]`
  \end{bmatrix}
\end{equation}

\begin{equation}
  \mathbf{m}
  =
  \begin{bmatrix}
    m_1 \\
    m_2 \\
    m_3
  \end{bmatrix}
  =
  \begin{bmatrix}
    `r m[1, 1]` \\
    `r m[2, 1]` \\
    `r m[3, 1]`
  \end{bmatrix}
\end{equation}

To filter the observed variables, use the following filter matrix

\begin{equation}
  \mathbf{F}
  =
  \begin{bmatrix}
    `r filter[1, 1]` & `r filter[1, 2]` & `r filter[1, 3]` \\
    `r filter[2, 1]` & `r filter[2, 2]` & `r filter[2, 3]`
  \end{bmatrix} .
\end{equation}

To include all variables, use the following filter matrix

\begin{equation}
  \mathbf{F}
  =
  \begin{bmatrix}
    `r filter[1, 1]` & `r filter[1, 2]` & `r filter[1, 3]` \\
    `r filter[2, 1]` & `r filter[2, 2]` & `r filter[2, 3]` \\
    `r filter[3, 1]` & `r filter[3, 2]` & `r filter[3, 3]`
  \end{bmatrix} .
\end{equation}

### Path Diagram

```{tikz, regression-01, echo = FALSE, fig.width = 4, fig.cap = "The Simple Linear Regression Model (with $u$)", fig.ext=if (knitr:::is_latex_output()) "pdf" else "png", cache = TRUE}
\usetikzlibrary{er, arrows, positioning}
\begin{tikzpicture}[
  auto,
  node distance = 20mm,
  manifest/.style = {
    rectangle,
    draw,
    thick,
    inner sep = 0pt,
    minimum width = 15mm,
    minimum height = 10mm
  },
  inv/.style = {
    rectangle,
    draw=none,
    fill=none,
    inner sep = 0pt,
    minimum width = 15mm,
    minimum height = 10mm
  },
  error/.style = {
    ellipse,
    draw,
    thick,
    inner sep = 0pt,
    minimum size = 7mm,
    align = center
  },
  mean/.style={
    regular polygon,
    regular polygon sides = 3,
    draw,
    thick,
    inner sep = 0pt,
    minimum width = 15mm,
    minimum height = 10mm
  },
  path/.style = {
    ->,
    thick,
    >=stealth'
  },
  cov/.style = {
    <->,
    thick,
    >=stealth'
  },
]
  \node[manifest] (v1) {$v_1$};
  \node[mean] (1) [above = of v1] {$1$};
  \node[manifest] (v2) [right = of v1] {$v_2$};
  \node[error] (u) [below = of v1] {$u$};
  \draw [path] (1) to node {$m_1$} (v1);
  \draw [path] (1) to node {$m_2$} (v2);
  \draw [path] (v2) to node {$a_{1,2}$} (v1);
  \draw [path] (u) to node {1} (v1);
  \draw [cov] (u) to[out=-60,in=-120,looseness=7] node[below] {$\omega_{3, 3}$} (u);
  \draw [cov] (1) to[out=70,in=110,looseness=5] node[above] {1} (1);
  \draw [cov] (v2) to[out=70,in=110,looseness=5] node[above] {$\omega_{2, 2}$} (v2);
\end{tikzpicture}
```

### Expectations

\begin{equation}
  \mathbb{E}
  \left(
    u
  \right)
  =
  m_3
  =
  `r m3`
\end{equation}

\begin{equation}
  \mathbb{E}
  \left(
    v_2
  \right)
  =
  m_2
  =
  `r m2`
\end{equation}

\begin{equation}
  \begin{split}
    \mathbb{E}
    \left(
      v_1
    \right)
    &=
    \mathbb{E}
    \left(
      m_1 + a_{1, 2} v_2 + \varepsilon
    \right) \\
    &=
    \mathbb{E}
    \left(
      m_1
    \right)
    +
    \mathbb{E}
    \left(
      a_{1, 2} v_2
    \right)
    +
    \mathbb{E}
    \left(
      \varepsilon
    \right) \\
    &=
    m_1
    +
    a_{1, 2}
    \mathbb{E}
    \left(
      v_2
    \right)
    +
    \mathbb{E}
    \left(
      \varepsilon
    \right) \\
    &=
    m_1
    +
    a_{1, 2}
    m_2
    +
    0 \\
    &=
    m_1
    +
    a_{1, 2}
    m_2 \\
    &=
    `r m1`
    +
    `r a12`
    \times
    `r m2` \\
    &=
    `r m1 + a12 * m2`
  \end{split}
\end{equation}

\begin{equation}
  \begin{split}
    \mathbb{E}
    \left(
      \begin{bmatrix}
        v_1 \\
        v_2 \\
        u
      \end{bmatrix}
    \right)
    &=
    \begin{bmatrix}
      m_1 + a_{1, 2} m_2 \\
      m_2 \\
      m_3
    \end{bmatrix} \\
    &=
    \begin{bmatrix}
      `r mu[1, 1]` \\
      `r mu[2, 1]` \\
      `r mu[3, 1]`
    \end{bmatrix}
  \end{split}
\end{equation}

\begin{equation}
  \begin{split}
    \mathrm{Cov}
    \left(
      u,
      u 
    \right)
    &=
    \mathrm{Var}
    \left(
      u 
    \right) \\
    &=
    \omega_{3, 3} \\
    &=
    `r omega33`
  \end{split}
\end{equation}

\begin{equation}
  \begin{split}
    \mathrm{Cov}
    \left(
      v_1,
      u 
    \right)
    &=
    \mathrm{Cov}
    \left(
      a_{1, 2} v_2 + u,
      u 
    \right) \\
    &=
    \mathrm{Cov}
    \left(
      a_{1, 2} v_2, u
    \right)
    +
    \mathrm{Cov}
    \left(
      u, u
    \right) \\
    &=
    a_{1, 2}^{2}
    \mathrm{Cov}
    \left(
      v_2, u
    \right)
    +
    \mathrm{Var}
    \left(
      u
    \right) \\
    &=
    a_{1, 2}^{2}
    \cdot
    0
    +
    \omega_{3, 3} \\
    &=
    0
    +
    \omega_{3, 3} \\
    &=
    \omega_{3, 3} \\
    &=
    `r omega33`
  \end{split}
\end{equation}

\begin{equation}
  \mathrm{Cov}
  \left(
    v_2,
    u 
  \right)
  =
  0
\end{equation}

\begin{equation}
  \begin{split}
    \mathrm{Cov} \left( v_1, v_1 \right)
    &=
    \mathrm{Cov}
    \left(
      a_{1, 2} v_2 + u,
      a_{1, 2} v_2 + u 
    \right) \\
    &=
    \mathrm{Cov} \left( a_{1, 2} v_2, a_{1, 2} v_2 \right)
    +
    \mathrm{Cov} \left( a_{1, 2} v_2, u \right)
    +
    \mathrm{Cov} \left( a_{1, 2} v_2, u \right)
    +
    \mathrm{Cov} \left( u, u \right) \\
    &=
    a_{1, 2}^{2} \mathrm{Cov} \left( v_2 \right)
    +
    a_{1, 2} \mathrm{Cov} \left( v_2, u \right)
    +
    a_{1, 2} \mathrm{Cov} \left( v_2, u \right)
    +
    \mathrm{Var} \left( u, u \right) \\
    &=
    a_{1, 2}^{2} \mathrm{Var} \left( v_2 \right)
    +
    a_{1, 2} 0
    +
    a_{1, 2} 0
    +
    \omega_{3, 3} \\
    &=
    a_{1, 2}^{2} \omega_{2, 2} + \omega_{3, 3} \\
    &=
    `r a12`^{2} \times `r omega22` + `r omega33` \\
    &=
    `r a12^2 * omega22 + omega33`
  \end{split}
\end{equation}

\begin{equation}
  \begin{split}
    \mathrm{Cov} \left( v_2, v_1 \right)
    &=
    \mathrm{Cov} \left( v_2, a_{1, 2} v_2 + u \right) \\
    &=
    \mathrm{Cov} \left( v_2, a_{1, 2} v_2 \right)
    +
    \mathrm{Cov} \left( v_2, u \right) \\
    &=
    a_{1, 2} \mathrm{Cov} \left( v_2, v_2 \right)
    +
    0 \\
    &=
    a_{1, 2} \mathrm{Var} \left( v_2 \right) \\
    &=
    a_{1, 2} \omega_{2, 2} \\
    &=
    `r a12` \times `r omega22` \\ 
    &=
    `r a12 * omega22` \\ 
  \end{split}
\end{equation}

\begin{equation}
  \begin{split}
    \mathrm{Cov} \left( v_2, v_2 \right)
    &=
    \mathrm{Var} \left( v_2 \right) \\
    &=
    \omega_{2, 2} \\
    &=
    `r omega22`
  \end{split}
\end{equation}

\begin{equation}
  \begin{split}
    \mathrm{Cov}
    \left(
      \begin{bmatrix}
        v_1 \\
        v_2 \\
        u
      \end{bmatrix}
    \right)
    &=
    \begin{bmatrix}
      a_{1, 2}^{2} \omega_{2, 2} + \omega_{3, 3} & a_{1, 2} \omega_{2, 2} & \omega_{3, 3} \\
      a_{1, 2} \omega_{2, 2} & \omega_{2, 2} & 0 \\
      \omega_{3, 3} & 0 & \omega_{3, 3}
    \end{bmatrix} \\
    &=
    \begin{bmatrix}
      `r Cov[1, 1]` & `r Cov[1, 2]` & `r Cov[1, 3]` \\
      `r Cov[2, 1]` & `r Cov[2, 2]` & `r Cov[2, 3]` \\
      `r Cov[3, 1]` & `r Cov[3, 2]` & `r Cov[3, 3]`
    \end{bmatrix}
  \end{split}
\end{equation}

#### Using the `ram()` Package

```{r}
knitr::kable(
  ram::mutheta(
    m,
    A = A,
    filter = filter
  ),
  col.names = "$\\boldsymbol{\\mu}$",
  caption = "$\\boldsymbol{\\mu} \\left( \\boldsymbol{\\theta} \\right)$",
  escape = FALSE
)
```
```{r}
knitr::kable(
  ram::Sigmatheta(
    A = A,
    Omega = Omega,
    filter = filter
  ),
  caption = "$\\boldsymbol{\\Sigma} \\left( \\boldsymbol{\\theta} \\right)$",
  escape = FALSE
)
```

## Specification 2 - Observed Variables

```{r, echo = FALSE}
A <- A[1:2, 1:2]
Omega <- Omega[1:2, 1:2]
Omega[1, 1] <- omega33
omega11 <- Omega[1, 1]
m <- m[1:2, , drop = FALSE]
Cov <- Cov[1:2, 1:2]
mu <- mu[1:2, , drop = FALSE]
filter <- filter[1:2, 1:2]
```

### Matrix Notation

\begin{equation}
  \mathrm{variables}
  =
  \begin{bmatrix}
    v_1 \\
    v_2
  \end{bmatrix}
\end{equation}

\begin{equation}
  \mathbf{A}
  =
  \begin{bmatrix}
    0 & a_{1, 2} \\
    0 & 0
  \end{bmatrix}
  =
  \begin{bmatrix}
    `r A[1, 1]` & `r A[1, 2]` \\
    `r A[2, 1]` & `r A[2, 2]`
  \end{bmatrix}
\end{equation}

\begin{equation}
  \boldsymbol{\Omega}
  =
  \begin{bmatrix}
    \omega_{1, 1} & 0             \\
    0             & \omega_{2, 2}
  \end{bmatrix}
  =
  \begin{bmatrix}
    `r Omega[1, 1]` & `r Omega[1, 2]` \\
    `r Omega[2, 1]` & `r Omega[2, 2]`
  \end{bmatrix}
\end{equation}

\begin{equation}
  \mathbf{m}
  =
  \begin{bmatrix}
    m_1 \\
    m_2
  \end{bmatrix}
  =
  \begin{bmatrix}
    `r m[1, 1]` \\
    `r m[2, 1]`
  \end{bmatrix}
\end{equation}

\begin{equation}
  \mathbf{F}
  =
  \begin{bmatrix}
    `r filter[1, 1]` & `r filter[1, 2]` \\
    `r filter[2, 1]` & `r filter[2, 2]`
  \end{bmatrix}
\end{equation}

### Path Diagram

```{tikz, regression-02, echo = FALSE, fig.width = 4, fig.cap = "The Simple Linear Regression Model (without $u$)", fig.ext = "png", cache = TRUE}
\usetikzlibrary{er, arrows, positioning}
\begin{tikzpicture}[
  auto,
  node distance = 20mm,
  manifest/.style = {
    rectangle,
    draw,
    thick,
    inner sep = 0pt,
    minimum width = 15mm,
    minimum height = 10mm
  },
  inv/.style = {
    rectangle,
    draw=none,
    fill=none,
    inner sep = 0pt,
    minimum width = 15mm,
    minimum height = 10mm
  },
  error/.style = {
    ellipse,
    draw,
    thick,
    inner sep = 0pt,
    minimum size = 7mm,
    align = center
  },
  mean/.style={
    regular polygon,
    regular polygon sides = 3,
    draw,
    thick,
    inner sep = 0pt,
    minimum width = 15mm,
    minimum height = 10mm
  },
  path/.style = {
    ->,
    thick,
    >=stealth'
  },
  cov/.style = {
    <->,
    thick,
    >=stealth'
  },
]
  \node[manifest] (v1) {$v_1$};
  \node[mean] (1) [above = of v1] {$1$};
  \node[manifest] (v2) [right = of v1] {$v_2$};
  \draw [path] (1) to node {$m_1$} (v1);
  \draw [path] (1) to node {$m_2$} (v2);
  \draw [path] (v2) to node {$a_{1,2}$} (v1);
  \draw [cov] (v1) to[out=-70,in=-110,looseness=5] node[below] {$\omega_{1, 1}$} (v1);
  \draw [cov] (1) to[out=70,in=110,looseness=5] node[above] {1} (1);
  \draw [cov] (v2) to[out=70,in=110,looseness=5] node[above] {$\omega_{2, 2}$} (v2);
\end{tikzpicture}
```

#### Using the `ram()` Package

```{r}
knitr::kable(
  ram::mutheta(
    m,
    A = A,
    filter = filter
  ),
  col.names = "$\\boldsymbol{\\mu}$",
  caption = "$\\boldsymbol{\\mu} \\left( \\boldsymbol{\\theta} \\right)$",
  escape = FALSE
)
```
```{r}
knitr::kable(
  ram::Sigmatheta(
    A = A,
    Omega = Omega,
    filter = filter
  ),
  caption = "$\\boldsymbol{\\Sigma} \\left( \\boldsymbol{\\theta} \\right)$",
  escape = FALSE
)
```